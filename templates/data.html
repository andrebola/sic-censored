{% extends "bootstrap/base.html" %}
{% import "bootstrap/wtf.html" as wtf %}

{%block title%} Artist's Data & playlist {%endblock%}
{% block navbar %}
{{nav.top.render()}}
{% endblock %}

{% block content %}
<meta charset="utf-8"/>
<!-- Load d3.js -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="https://d3js.org/d3.v3.min.js"></script>
<script src="../static/d3.layout.cloud.js"></script>

<style>
	.wordcloud {
		width: 100%;
		height: 100%;
	}
</style>

<div class="container">
	
	<h1>{{data.name}}</h1>
	<div class="row">
		<div class="col">
			<h2>Playlist</h2>
			<div class="row" style="display: flex !important;">
				<iframe src="{{data.playlist}}" width="300" height="380" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>
				<div id="wordcloud" style="width: 100%; height: 380px;"></div>
			</div>
		</div>
	</div>
	
</div>

<script>
	//var lyrics = $("<div/>").html('{{ lyrics }}').text();
	
    var svg_location = "#wordcloud";
    $(svg_location).text("Loading ... ");
    $.ajax({
    url: "/ajax/data/{{country}}",
    context: document.body,
    contentType:"applicaton/json",
    }).done(function(word_count) {
    console.log(word_count)
        $(svg_location).text("");
        var width = $("#wordcloud").width();
        var height = $("#wordcloud").height();

        var fill = d3.scale.category20();

        var word_entries = d3.entries(word_count);

        var xScale = d3.scale.linear()
           .domain([0, d3.max(word_entries, function(d) {
              return d.value;
            })
           ])
           .range([10,100]);

        d3.layout.cloud().size([width, height])
          .timeInterval(20)
          .words(word_entries)
          .fontSize(function(d) { return xScale(+d.value); })
          .text(function(d) { return d.key; })
          .rotate(function() { return ~~(Math.random() * 2) * 90; })
          .font("Impact")
          .on("end", draw)
          .start();

        function draw(words) {
          d3.select(svg_location).append("svg")
              .attr("width", width)
              .attr("height", height)
            .append("g")
              .attr("transform", "translate(" + [width >> 1, height >> 1] + ")")
            .selectAll("text")
              .data(words)
            .enter().append("text")
              .style("font-size", function(d) { return xScale(d.value) + "px"; })
              .style("font-family", "Impact")
              .style("fill", function(d, i) { return fill(i); })
              .attr("text-anchor", "middle")
              .attr("transform", function(d) {
                return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
              })
              .text(function(d) { return d.key; });
        }

        d3.layout.cloud().stop();
        });
        
</script>

{% endblock %}
